# 工作内容

标签（空格分隔）： 2016/09/09 xuehua

---
# 目录
## 0. 说明
机器名和ip对应地址请参见[附录](#fulu)
## 1. 服务器
### 1. 轨迹服务器
#### 1. 架构
#### 2. 问题
### 2. 查询服务器
#### 1. 架构
#### 2. 问题
### 3. API服务器
### 4. 第三方服务器
### 5. 其它服务器
#### 1. 在路上

## 2. 微信公众平台
## 3. 杂项
### 1. 数据分析
(1) 部署在[yun-new-nav-2-huazi](#fulu-jifang)
(2) cron任务
```
#sm start rvm
PATH="/usr/local/rvm/gems/ruby-2.0.0-p598/bin:/usr/local/rvm/gems/ruby-2.0.0-p598@global/bin:/usr/local/rvm/rubies/ruby-2.0.0-p598/bin:/home/huazi/git/nvm/versions/node/v0.12.4/bin:/usr/local/rvm/gems/ruby-2.0.0-p598/bin:/usr/local/rvm/gems/ruby-2.0.0-p598@global/bin:/usr/local/rvm/rubies/ruby-2.0.0-p598/bin:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/java/latest/bin:/usr/local/rvm/bin:/home/huazi/bin"
GEM_HOME='/usr/local/rvm/gems/ruby-2.0.0-p598'
GEM_PATH='/usr/local/rvm/gems/ruby-2.0.0-p598:/usr/local/rvm/gems/ruby-2.0.0-p598@global'
MY_RUBY_HOME='/usr/local/rvm/rubies/ruby-2.0.0-p598'
IRBRC='/usr/local/rvm/rubies/ruby-2.0.0-p598/.irbrc'
RUBY_VERSION='ruby-2.0.0-p598'
#sm end rvm 
10 2 * * * /usr/local/rvm/rubies/ruby-2.0.0-p598/bin/ruby /home/huazi/data_display/getimsi.rb >/dev/null 2>/dev/null
25 2 * * * /usr/local/rvm/rubies/ruby-2.0.0-p598/bin/ruby /home/huazi/data_display/run.rb &>/tmp/crontab.output
```
### 2. 采集数据
### 3. IOS版本轨迹查询
### 4. 卡导入
详细请参照
### 5. 电子狗数据更新上传
(0) 应用名称 meihua
(1) 部署在[yun-new-web-huazi](#fulu-jifang-web)
(2) 域名[http://www.e-dog.cn/downloads/go/yungo/home](http://www.e-dog.cn/downloads/go/yungo/home)
(3) nginx配置
```
[root@master ~]# vim /etc/nginx/conf.d/yungoservice.conf
```
```
    location ^~ /downloads/go/yungo/ {
        root /home/huazi/goes/meihua;
        rewrite ^(/downloads/go/yungo/update)$ / break;
        rewrite ^(/downloads/go/yungo/)(.*)$ /$2 break;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header Host        $http_host;
        proxy_pass http://127.0.0.1:8080;
    }   
```
(4)supervisor应用配置
```
[root@master ~]# vim /etc/supervisord.d/go_meihua.conf
```
```
[program:meihua]
directory = /home/huazi/goes/src/meihua
command = /home/huazi/goes/src/meihua/meihua
autostart = true
startsecs = 5 
user = huazi
redirect_stderr = true
stdout_logfile = /var/log/supervisord/go_meihua.log
```

#### 1. 启动和关闭

```
[root@master ~]# supervisorctl stop meihua
meihua: stopped
[root@master ~]# supervisorctl start meihua
meihua: started
```

#### 2. 文件覆盖
假设有两个数据更新文件
> data-tuotu-yungou.zip      dataV2-tuotu-yungou.zip 

覆盖服务器上的相同文件名即可。
```
[huazi@master ~]$ ls goes/src/meihua/download_resources/
data-tuotu-yungou.zip      dataV2-tuotu-yungou.zip      dvr_update201.exe  version
data-tuotu-yungou.zip.old  dataV2-tuotu-yungou.zip.old  update_201.exe
```

### 6. 批量删除设备轨迹

## 4. <span id="fulu">附录</span>
#### 服务器或应用名称说明
涉及到的服务器，对应的真实ip地址和对应的用户。
###### <span id="fulu-jifang">机房服务器</span>
| 机器名称 | IP地址 | 备注 |
| --------- | :------------- | :-------------|
| yun-new-nav-1-root | 116.204.10.143 | 超级用户root|
| yun-new-nav-1-huazi | 116.204.10.143 | 普通用户huazi|
| yun-new-nav-2-root | 116.204.10.144 |超级用户root|
| yun-new-nav-2-huazi | 116.204.10.144 |普通用户huazi|
| yun-new-nav-3-root | 116.204.10.97 |超级用户root|
| yun-new-nav-3-huazi | 116.204.10.97 |普通用户huazi|

###### <span id="fulu-jifang-web">机房服务器</span>
| 机器名称 | IP地址 | 备注 |
| --------- | :------------- | :-------------|
| yun-new-web-huazi | 116.204.8.31 |普通用户huazi|
| yun-new-web-root | 116.204.8.31 |超级用户root|

###### <span id="fulu-ali">阿里云服务器</span>
| 机器名称 | IP地址 | 备注 |
| --------- | :------------- | :-------------|
| aliyun-a-root  | 120.24.61.27 | 超级用户root|
| aliyun-a-huazi |120.24.61.27 | 普通用户huazi|
| aliyun-b-root  |120.24.61.201 | 超级用户root|
| aliyun-b-huazi | 120.24.61.201 | 普通用户huazi|

###### <span id="fulu-sae">新浪云服务器</span>
| 应用名称 | 备注 |
| --------- |:--------|
| sae-tuotu |http://tuotu2013tp.sinaapp.com|

#### <span id="fulu-lang">编程语言说明</span>
以ruby-2.1.3为例。
|名称| 语言 | 版本| 备注|
|------------|:----------|:---------|:---------|
|ruby-2.1.3|ruby|2.1.3|




